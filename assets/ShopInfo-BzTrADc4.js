import{d as p,y as j,e as S,b as e}from"./index-CjC2VP5G.js";function I({shop:i,onClose:g}){const[a,f]=p(null),[v,_]=p(!0),[l,h]=p([]),[u,o]=p("sections");j(()=>{S.getShopCatalog(i.id).then(n=>{f(n.catalog||null),_(!1)}).catch(()=>{_(!1)})},[i.id]);const m=n=>Array.isArray(n)?n.length:typeof n!="object"||n===null?0:Object.values(n).reduce((c,s)=>c+m(s),0),y=()=>{if(l.length===0)g();else{const n=[...l];n.pop(),h(n),n.length===0?o("sections"):n.length===1?o("categories"):n.length===2?o("models"):n.length===3&&o("submodels")}},k=()=>a?Object.keys(a).map(n=>{const c=m(a[n]);return e("div",{className:"category-card",onClick:()=>{h([n]),o("categories")},children:[e("h3",{children:n}),e("div",{className:"count",children:[c," ",c===1?"товар":"товаров"]})]},n)}):null,b=()=>{if(!a)return null;const n=l[0];return Object.keys(a[n]).map(c=>{const s=m(a[n][c]);return e("div",{className:"category-card",onClick:()=>{h([n,c]),o("models")},children:[e("h3",{children:c}),e("div",{className:"count",children:[s," ",s===1?"товар":"товаров"]})]},c)})},C=()=>{if(!a)return null;const[n,c]=l;return Object.keys(a[n][c]).map(s=>{const r=a[n][c][s],d=Object.keys(r),t=m(r);return d.length===1&&d[0]===""?e("div",{className:"category-card",onClick:()=>{h([n,c,s]),o("products")},children:[e("h3",{children:s}),e("div",{className:"count",children:[t," ",t===1?"товар":"товаров"]})]},s):e("div",{className:"category-card",onClick:()=>{h([n,c,s]),o("submodels")},children:[e("h3",{children:s}),e("div",{className:"count",children:[t," ",t===1?"товар":"товаров"]})]},s)})},O=()=>{if(!a)return null;const[n,c,s]=l;return Object.keys(a[n][c][s]).map(r=>{const t=a[n][c][s][r].length;return e("div",{className:"category-card",onClick:()=>{h(r===""?[n,c,s]:[n,c,s,r]),o("products")},children:[e("h3",{children:r||"Все модели"}),e("div",{className:"count",children:[t," ",t===1?"товар":"товаров"]})]},r)})},w=()=>{if(!a)return null;const[n,c,s,r=""]=l,d=a[n][c][s][r];return!d||d.length===0?e("div",{className:"empty-state",children:"Товары не найдены"}):d.map((t,P)=>e("div",{className:"catalog-item",children:[t.photo_url&&e("img",{src:t.photo_url,alt:t.color||"Товар",className:"catalog-item__photo"}),e("div",{className:"catalog-item__info",children:[e("span",{className:"catalog-item__name",children:t.color||"Без названия"}),t.user_description&&e("span",{className:"catalog-item__desc",children:t.user_description})]}),e("span",{className:"catalog-item__price",children:t.price||"Цена не указана"})]},P))},N=i.photo_url?`https://raw.githubusercontent.com/metakross0-sketch/chronosphere_app/main/images/${i.photo_url}`:null;return e("div",{className:"shop-info",onClick:g,children:e("div",{className:"shop-info__content",onClick:n=>n.stopPropagation(),children:[e("div",{className:"shop-info__header",children:[e("button",{className:"shop-info__back",onClick:y,children:"←"}),e("h2",{className:"shop-info__name",children:i.name}),e("button",{className:"shop-info__close",onClick:g,children:"✕"})]}),l.length>0&&e("div",{className:"breadcrumb",children:l.map((n,c)=>e("span",{children:[n," / "]},c))}),N&&e("div",{className:"shop-info__photo",children:e("img",{src:N,alt:i.name,onError:n=>n.currentTarget.style.display="none"})}),l.length===0&&e("div",{className:"shop-info__details",children:[e("div",{className:"shop-info__row",children:[e("span",{className:"label",children:"Категория:"}),e("span",{className:"value",children:i.category})]}),e("div",{className:"shop-info__row",children:[e("span",{className:"label",children:"Активность:"}),e("span",{className:"value",children:[Math.round((i.activity||0)*100),"%"]})]})]}),e("div",{className:"shop-info__catalog-section",children:v?e("div",{className:"shop-info__loading",children:"Загрузка каталога..."}):a&&Object.keys(a).length>0?e("div",{className:"shop-info__grid",children:[u==="sections"&&k(),u==="categories"&&b(),u==="models"&&C(),u==="submodels"&&O(),u==="products"&&w()]}):e("div",{className:"shop-info__empty",children:"Каталог пуст или не загружен"})})]})})}export{I as ShopInfo};
